<html lang="en_US">

<head>
  <title>Speed up your algorithms (cpp) : Solution</title>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <link href="../../style/ontologenius_api.css" rel="stylesheet" type="text/css">
  <link href="../../images/favicon.ico" rel="shortcut icon">
  <link href="../../images/favicon-32x32.png" rel="icon" type="image/png">
  <link href="../../images/favicon-16x16.png" rel="icon" type="image/png">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
</head>

<body>
  <div class="header" id="header">
    <header class="fixed" id="navbar">
      <div class="container">
          <div class="navbar-header">
            <div id="header-buttons">
                <ul id="header-ul" data-event="hover_intent" data-effect="fade" data-effect-speed="500">
                    <li class="header-item"><a class="header-link" href="https://github.com/sarthou/ontologenius" tabindex="0"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Octicons-mark-github.svg/1200px-Octicons-mark-github.svg.png" alt="github" width="40px" height="40px"/></a></li>
                </ul>
            </div>
            <a class="navbar-icon" href="../../index.html">
              <img src="../../images/ontologenius.png " alt="ontologenius" width="65px" height="65px"/>
            </a>
        </div>
      </div>
    </header>
  </div>

  <div class="main">

    <div class="navigationbar">
      <ul class="sub-navigation">
        <li><a href="https://github.com/sarthou/ontologenius/tree/master/src/API/ontologenius">C++ API sources</a></li>
        <li><a href="https://github.com/sarthou/ontologenius/tree/master/include/ontologenius/API/ontologenius">C++ API headers</a></li>
        <li><a href="https://github.com/sarthou/ontologenius/tree/master/ontopy/ontologenius">Pyhton API sources</a></li>
        <li><a href="https://gitlab.com/sarthou/ontologenius/pipelines">Pipelines</a></li>
      </ul>
      <h1>Ontologenius Cpp Documentation</h1>
    </div>

    <div class="content">
      <div class="sidebar" style="transition: all 0.2s ease-out 0s; top: 0px;">
        <div class="contents">
          <div id="contents-toggle" class=""></div>
          <h3>Contents</h3>
          <ul style="display: block;">
            <li class="level1"><a href="Overview.html">1. Overview</a></li>
            <li class="level1"><a href="Solution.html"><b>2. Solution</b></a></li>
          </ul>
        </div>

        <div class="contents">
          <div id="contents-toggle" class=""></div>
          <h3>Getting Start</h3>
          <ul style="display: block;">
            <li class="level1"><a href="../../Download.html">Download</a></li>
            <li class="level1">Install Ontologenius</li>
            <li class="level2"><a href="../../InstallOntologeniusROS1.html">- Install with ROS1</a></li>
            <li class="level2"><a href="../../InstallOntologeniusROS2.html">- Install with ROS2</a></li>
            <li class="level1"><a href="../../SetUp.html">Set Up Your Environnement</a></li>
            <li class="level1"><a href="../Tutorials.html">Cpp Tutorials</a></li>
            <li class="level1"><a href="../../python_Tutorials/Tutorials.html">Python Tutorials</a></li>
          </ul>
        </div>

        <div class="contents">
          <div id="contents-toggle" class=""></div>
          <h3>Overview</h3>
          <ul style="display: block;">
            <li class="level1"><a href="../../overview/launchers.html">Launchers</a></li>
            <li class="level1"><a href="../../overview/ontoloGUI.html">OntoloGUI</a></li>
            <li class="level1"><a href="../../overview/reasonersConfiguration.html">Reasoners configuration</a></li>
            <!--li class="level1"><a href="plugins.html">Plugins</a></li-->
          </ul>
        </div>

        <div class="contents">
          <div id="contents-toggle" class=""></div>
          <h3>
            <i class="fas fa-angle-down"></i>
            <a href="../../cpp_API/CppAPI.html">
              All C++ Classes
            </a>
          </h3>
          <ul style="display: block;">
            <li class="level1"><a href="../../cpp_API/ActionClient.html">ActionClient</a></li>
            <li class="level1"><a href="../../cpp_API/ClassClient.html">ClassClient</a></li>
            <li class="level1"><a href="../../cpp_API/ClientBase.html">ClientBase</a></li>
            <li class="level1"><a href="../../cpp_API/DataPropertyClient.html">DataPropertyClient</a></li>
            <li class="level1"><a href="../../cpp_API/FeederPublisher.html">FeederPublisher</a></li>
            <li class="level1"><a href="../../cpp_API/IndividualClient.html">IndividualClient</a></li>
            <li class="level1"><a href="../../cpp_API/ManagerClient.html">ManagerClient</a></li>
            <li class="level1"><a href="../../cpp_API/ObjectPropertyClient.html">ObjectPropertyClient</a></li>
            <li class="level1"><a href="../../cpp_API/OntologiesManipulator.html">OntologiesManipulator</a></li>
            <li class="level1"><a href="../../cpp_API/OntologyClient.html">OntologyClient</a></li>
            <li class="level1"><a href="../../cpp_API/OntologyManipulator.html">OntologyManipulator</a></li>
            <li class="level1"><a href="../../cpp_API/ReasonerClient.html">ReasonerClient</a></li>
            <li class="level1"><a href="../../cpp_API/SparqlClient.html">SparqlClient</a></li>
            <li class="level2"><b>Index based classes</b></li>
            <li class="level1"><a href="../../cpp_API/ClassIndexClient.html">ClassIndexClient</a></li>
            <li class="level1"><a href="../../cpp_API/ClientBaseIndex.html">ClientBaseIndex</a></li>
            <li class="level1"><a href="../../cpp_API/ConversionClient.html">ConversionClient</a></li>
            <li class="level1"><a href="../../cpp_API/DataPropertyIndexClient.html">DataPropertyIndexClient</a></li>
            <li class="level1"><a href="../../cpp_API/IndividualIndexClient.html">IndividualIndexClient</a></li>
            <li class="level1"><a href="../../cpp_API/ObjectPropertyIndexClient.html">ObjectPropertyIndexClient</a></li>
            <li class="level1"><a href="../../cpp_API/OntologyIndexClient.html">OntologyIndexClient</a></li>
            <li class="level1"><a href="../../cpp_API/OntologyManipulatorIndex.html">OntologyManipulatorIndex</a></li>
            <li class="level1"><a href="../../cpp_API/SparqlIndexClient.html">SparqlIndexClient</a></li>
          </ul>
          </br>
          <h3>
            <i class="fas fa-angle-right"></i>
            <a href="../../python_API/PythonAPI.html">
              All Python Classes
            </a>
          </h3>
        </div>
      </div>

      <div class="context">
        <div class="toturial-header">
          <h1 class="title">Speed up your algorithms (cpp)</h1>
          <a class="toturial-subheader">
            <div class="tutorial-subheader__main-icon">
              <i class="fas fa-brain"></i>
            </div>
            <div class="toturial-subheader__title">
              <h2 class="title">Run Forrest! Run !</h2>
            </div>
          </a>
        </div>

        <h1 class="title">Solution</h1>

        <p>Here is a possible solution with use of templates.
          You can note that we have queried the index of the property "isAlong" only once at the initialisation to avoid to recompute static information.
          In a more usual way using classes, you could create a map with all the "static" indexes.</p>

        <div class="code_block cpp_code" style="counter-reset:code_line 0;">
          <div class="code_line"><span class="cpp_include">#include</span> <span class="cpp_included">&lt;iostream&gt;</span></div>
          <div class="code_line"><span class="cpp_include">#include</span> <span class="cpp_included">&lt;vector&gt;</span></div>
          <div class="code_line"><span class="cpp_include">#include</span> <span class="cpp_included">&lt;string&gt;</span></div>
          <div class="code_line"><br></div>
          <div class="code_line"><span class="cpp_include">#include</span> <span class="cpp_included">&quot;ros/ros.h&quot;</span></div>
          <div class="code_line"><span class="cpp_include">#include</span> <span class="cpp_included">&quot;ontologenius/OntologyManipulatorIndex.h&quot;</span></div>
          <div class="code_line"><br></div>
          <div class="code_line">onto::<span class="cpp_type">OntologyManipulatorIndex</span>* onto_;</div>
          <div class="code_line"><span class="cpp_type">int64_t</span> is_along_ <span class="cpp_op">=</span> <span class="cpp_value">0</span>;</div>
          <div class="code_line"><br></div>
          <div class="code_line"><span class="cpp_type">void</span> displayRoute(std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">int64_t</span>&gt; route)</div>
          <div class="code_line">{</div>
          <div class="code_line">  std::<span class="cpp_type">vector</span>&lt;std::<span class="cpp_type">string</span>&gt; indentifier_route <span class="cpp_op">=</span> onto_-&gt;conversion.individualsIndex2Id(route);</div>
          <div class="code_line">  <span class="cpp_op">for</span>(<span class="cpp_type">auto</span> path : indentifier_route)</div>
          <div class="code_line">    std::cout <span class="cpp_op">&lt;&lt;</span> path <span class="cpp_op">&lt;&lt;</span> <span class="cpp_string">&quot; - &quot;</span>;</div>
          <div class="code_line">  std::cout <span class="cpp_op">&lt;&lt;</span> std::endl;</div>
          <div class="code_line">}</div>
          <div class="code_line"><br></div>
          <div class="code_line">template&lt;typename <span class="cpp_type">T</span>&gt;</div>
          <div class="code_line">std::<span class="cpp_type">vector</span>&lt;std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; &gt; findRoutes(<span class="cpp_type">T</span> path_from, <span class="cpp_type">T</span> path_to, <span class="cpp_type">T</span> selector)</div>
          <div class="code_line">{</div>
          <div class="code_line">  std::<span class="cpp_type">vector</span>&lt;std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; &gt; routes;</div>
          <div class="code_line">  bool found <span class="cpp_op">=</span> <span class="cpp_value">false</span>;</div>
          <div class="code_line"><br></div>
          <div class="code_line">  std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; tmp;</div>
          <div class="code_line">  tmp.push_back(path_from);</div>
          <div class="code_line">  routes.push_back(tmp);</div>
          <div class="code_line"><br></div>
          <div class="code_line">  <span class="cpp_op">if</span>(path_from <span class="cpp_op">==</span> path_to)</div>
          <div class="code_line">    found <span class="cpp_op">=</span> <span class="cpp_value">true</span>;</div>
          <div class="code_line"><br></div>
          <div class="code_line">  <span class="cpp_op">while</span>(found <span class="cpp_op">==</span> <span class="cpp_value">false</span>)</div>
          <div class="code_line">  {</div>
          <div class="code_line">    std::<span class="cpp_type">vector</span>&lt;std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; &gt; tmp_routes;</div>
          <div class="code_line">    <span class="cpp_op">for</span>(<span class="cpp_type">auto</span>& route : routes)</div>
          <div class="code_line">    {</div>
          <div class="code_line">      std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; intersections <span class="cpp_op">=</span> onto_-&gt;individuals.getFrom(is_along_, route.back());</div>
          <div class="code_line"><br></div>
          <div class="code_line">      <span class="cpp_op">for</span>(<span class="cpp_type">auto</span> intersection : intersections)</div>
          <div class="code_line">      {</div>
          <div class="code_line">        std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; paths <span class="cpp_op">=</span> onto_-&gt;individuals.getOn(intersection, is_along_, selector);</div>
          <div class="code_line"><br></div>
          <div class="code_line">        <span class="cpp_op">for</span>(<span class="cpp_type">size_t</span> i <span class="cpp_op">=</span> <span class="cpp_value">0</span>; i <span class="cpp_op">&lt;</span> paths.size();)</div>
          <div class="code_line">          <span class="cpp_op">if</span>(std::find(route.begin(), route.end(), paths[i]) <span class="cpp_op">!=</span> route.end())</div>
          <div class="code_line">            paths.erase(paths.begin() <span class="cpp_op">+</span> i);</div>
          <div class="code_line">          <span class="cpp_op">else</span></div>
          <div class="code_line">            i<span class="cpp_op">++</span>;</div>
          <div class="code_line"><br></div>
          <div class="code_line">        <span class="cpp_op">for</span>(<span class="cpp_type">auto</span> path : paths)</div>
          <div class="code_line">        {</div>
          <div class="code_line">          tmp <span class="cpp_op">=</span> route;</div>
          <div class="code_line">          tmp.push_back(intersection);</div>
          <div class="code_line">          tmp.push_back(path);</div>
          <div class="code_line">          tmp_routes.push_back(tmp);</div>
          <div class="code_line">          <span class="cpp_op">if</span>(path <span class="cpp_op">==</span> path_to)</div>
          <div class="code_line">            found <span class="cpp_op">=</span> <span class="cpp_value">true</span>;</div>
          <div class="code_line">        }</div>
          <div class="code_line">      }</div>
          <div class="code_line">    }</div>
          <div class="code_line">    routes.swap(tmp_routes);</div>
          <div class="code_line">  }</div>
          <div class="code_line"><br></div>
          <div class="code_line">  <span class="cpp_return">return</span> routes;</div>
          <div class="code_line">}</div>
          <div class="code_line"><br></div>
          <div class="code_line">template&lt;typename <span class="cpp_type">T</span>&gt;</div>
          <div class="code_line">std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; find(<span class="cpp_type">T</span> from, <span class="cpp_type">T</span> to, <span class="cpp_type">T</span> selector)</div>
          <div class="code_line">{</div>
          <div class="code_line">  std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; solution_route;</div>
          <div class="code_line">  <span class="cpp_type">size_t</span> min_size <span class="cpp_op">=</span> -<span class="cpp_value">1</span>;</div>
          <div class="code_line"><br></div>
          <div class="code_line">  std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; paths_from <span class="cpp_op">=</span> onto_-&gt;individuals.getOn(from, is_along_, selector);</div>
          <div class="code_line">  std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; paths_to <span class="cpp_op">=</span> onto_-&gt;individuals.getOn(to, is_along_, selector);</div>
          <div class="code_line"><br></div>
          <div class="code_line">  <span class="cpp_op">for</span>(<span class="cpp_type">auto</span> path_from : paths_from)</div>
          <div class="code_line">    <span class="cpp_op">for</span>(<span class="cpp_type">auto</span> path_to : paths_to)</div>
          <div class="code_line">    {</div>
          <div class="code_line">      std::<span class="cpp_type">vector</span>&lt;std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">T</span>&gt; &gt; routes <span class="cpp_op">=</span> findRoutes(path_from, path_to, selector);</div>
          <div class="code_line">      <span class="cpp_op">for</span>(<span class="cpp_type">auto</span>& route : routes)</div>
          <div class="code_line">        <span class="cpp_op">if</span>(route.back() =<span class="cpp_op">=</span> path_to)</div>
          <div class="code_line">          <span class="cpp_op">if</span>(route.size() <span class="cpp_op">&lt;</span> min_size)</div>
          <div class="code_line">          {</div>
          <div class="code_line">            min_size <span class="cpp_op">=</span> route.size();</div>
          <div class="code_line">            solution_route <span class="cpp_op">=</span> route;</div>
          <div class="code_line">          }</div>
          <div class="code_line">    }</div>
          <div class="code_line"><br></div>
          <div class="code_line">  <span class="cpp_return">return</span> solution_route;</div>
          <div class="code_line">}</div>
          <div class="code_line"><br></div>
          <div class="code_line"><span class="cpp_type">int</span> main(<span class="cpp_type">int</span> argc, <span class="cpp_type">char</span>** argv)</div>
          <div class="code_line">{</div>
          <div class="code_line">  ros::init(argc, argv, <span class="cpp_string">&quot;find_our_way&quot;</span>);</div>
          <div class="code_line"><br></div>
          <div class="code_line">  ros::NodeHandle n;</div>
          <div class="code_line">  onto::<span class="cpp_type">OntologyManipulatorIndex</span> onto;</div>
          <div class="code_line">  onto_ <span class="cpp_op">=</span> &onto;</div>
          <div class="code_line"><br></div>
          <div class="code_line">  onto.close();</div>
          <div class="code_line"><br></div>
          <div class="code_line">  is_along_ <span class="cpp_op">=</span> onto.conversion.objectPropertiesId2Index(<span class="cpp_string">&quot;isAlong&quot;</span>);</div>
          <div class="code_line">  <span class="cpp_type">int64_t</span> pub <span class="cpp_op">=</span> onto.conversion.individualsId2Index(<span class="cpp_string">&quot;pub&quot;</span>);</div>
          <div class="code_line">  <span class="cpp_type">int64_t</span> house <span class="cpp_op">=</span> onto.conversion.individualsId2Index(<span class="cpp_string">&quot;house&quot;</span>);</div>
          <div class="code_line">  <span class="cpp_type">int64_t</span> car <span class="cpp_op">=</span> onto.conversion.individualsId2Index(<span class="cpp_string">&quot;car&quot;</span>);</div>
          <div class="code_line">  <span class="cpp_type">int64_t</span> path <span class="cpp_op">=</span> onto.conversion.classesId2Index(<span class="cpp_string">&quot;path&quot;</span>);</div>
          <div class="code_line">  <span class="cpp_type">int64_t</span> road <span class="cpp_op">=</span> onto.conversion.classesId2Index(<span class="cpp_string">&quot;road&quot;</span>);</div>
          <div class="code_line">  std::<span class="cpp_type">vector</span>&lt;<span class="cpp_type">int64_t</span>&gt; route;</div>
          <div class="code_line"><br></div>
          <div class="code_line">  route <span class="cpp_op">=</span> find(pub, house, path);</div>
          <div class="code_line">  displayRoute(route);</div>
          <div class="code_line"><br></div>
          <div class="code_line">  route <span class="cpp_op">=</span> find(house, car, path);</div>
          <div class="code_line">  displayRoute(route);</div>
          <div class="code_line"><br></div>
          <div class="code_line">  route <span class="cpp_op">=</span> find(car, house, road);</div>
          <div class="code_line">  displayRoute(route);</div>
          <div class="code_line"><br></div>
          <div class="code_line">  <span class="cpp_return">return</span> <span class="cpp_value">0</span>;</div>
          <div class="code_line">}</div>
          <div class="code_line"><br></div>
        </div>

        <nav class="course-pagination">
          <a href="Overview.html" class="course-pagination__btn">
            <i class="fas fa-angle-left"></i>
            <span>Overview</span>
          </a>
          <span class="course-pagination__separator"></span>
          <a href="../Tutorials.html" class="course-pagination__btn">
            <span>Tutorials</span>
            <i class="fas fa-angle-right"></i>
          </a>
        </nav>

      </div>
    </div>

  </div>
</body>

<footer>
  <div align="center">
    <p>
      Brought to you by:
      <a class="laas_logo" href="https://www.laas.fr/public/">
        <img src="../../images/LogoLAAS-2016_BW.png " alt="LAAS-CNRS" height="60px"/>
      </a>
    </p>
  </div>
</footer>

</html>
